<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PROCEDURAL SCREAMING STICKMAN â€“ Web Audio API Hell Edition</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: #0a0f2e;
    overflow: hidden;
    cursor: crosshair;
    font-family: system-ui, sans-serif;
  }
  #container {
    position: absolute;
    width: 60px;
    height: 100px;
    pointer-events: none;
    z-index: 1000;
    will-change: left, top;
  }
  svg {
    width: 100%;
    height: 100%;
    overflow: visible;
  }
  .hint {
    position: fixed;
    top: 20px;
    left: 20px;
    color: #ff6b6b;
    background: rgba(0,0,0,0.65);
    padding: 14px 24px;
    border-radius: 16px;
    font-size: 1.3rem;
    pointer-events: none;
    user-select: none;
    z-index: 2000;
    text-shadow: 0 0 8px #000;
  }
</style>
</head>
<body>
<div class="hint">CLICK ANYWHERE</div>

<div id="container">
  <svg id="stickman" viewBox="0 0 60 100">
    <circle id="head" cx="30" cy="20" r="10" fill="#fff" stroke="#000" stroke-width="2"/>
    <line id="body" x1="30" y1="30" x2="30" y2="60" stroke="#000" stroke-width="4"/>
    <line id="arm-left" x1="30" y1="35" x2="15" y2="50" stroke="#000" stroke-width="3"/>
    <line id="arm-right" x1="30" y1="35" x2="45" y2="50" stroke="#000" stroke-width="3"/>
    <line id="leg-left" x1="30" y1="60" x2="20" y2="90" stroke="#000" stroke-width="4"/>
    <line id="leg-right" x1="30" y1="60" x2="40" y2="90" stroke="#000" stroke-width="4"/>
  </svg>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//          WEB AUDIO API â€“ PROCEDURAL CHAOS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let audioCtx;
try {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
} catch (e) {
  console.warn("AudioContext not supported â€“ no screams today ðŸ˜¢");
}

function createFootstep() {
  if (!audioCtx) return;
  const now = audioCtx.currentTime;

  // Noise burst for "crunch"
  const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.06, audioCtx.sampleRate);
  const data = noiseBuffer.getChannelData(0);
  for (let i = 0; i < data.length; i++) {
    data[i] = Math.random() * 2 - 1;
  }
  const noiseSource = audioCtx.createBufferSource();
  noiseSource.buffer = noiseBuffer;

  // Low-pass filter â€“ makes it thumpy/leathery
  const filter = audioCtx.createBiquadFilter();
  filter.type = 'lowpass';
  filter.frequency.setValueAtTime(800 + Math.random() * 600, now);
  filter.Q.value = 1;

  // Gain envelope â€“ quick attack + decay
  const gain = audioCtx.createGain();
  gain.gain.setValueAtTime(0, now);
  gain.gain.linearRampToValueAtTime(0.7 + Math.random() * 0.3, now + 0.005);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.08 + Math.random() * 0.04);

  // Slight pitch wobble for cartoon feel
  const panner = audioCtx.createStereoPanner();
  panner.pan.value = (Math.random() - 0.5) * 0.4;

  noiseSource.connect(filter);
  filter.connect(gain);
  gain.connect(panner);
  panner.connect(audioCtx.destination);

  noiseSource.start(now);
  noiseSource.stop(now + 0.12);
}

function playWhoosh() {
  if (!audioCtx) return;
  const now = audioCtx.currentTime;

  // Noise + descending sine for whoosh
  const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.4, audioCtx.sampleRate);
  const data = noiseBuffer.getChannelData(0);
  for (let i = 0; i < data.length; i++) {
    data[i] = (Math.random() * 2 - 1) * (1 - i / data.length);
  }
  const noise = audioCtx.createBufferSource();
  noise.buffer = noiseBuffer;

  const sine = audioCtx.createOscillator();
  sine.type = 'sine';
  sine.frequency.setValueAtTime(900 + Math.random() * 400, now);
  sine.frequency.exponentialRampToValueAtTime(120, now + 0.35);

  const gain = audioCtx.createGain();
  gain.gain.setValueAtTime(0.6, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.4);

  const filter = audioCtx.createBiquadFilter();
  filter.type = 'lowpass';
  filter.frequency.setValueAtTime(2000, now);
  filter.frequency.exponentialRampToValueAtTime(400, now + 0.35);

  noise.connect(filter);
  sine.connect(filter);
  filter.connect(gain);
  gain.connect(audioCtx.destination);

  noise.start(now);
  sine.start(now);
  noise.stop(now + 0.45);
  sine.stop(now + 0.45);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//                   STICKMAN LOGIC
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const container = document.getElementById('container');
const svg = document.getElementById('stickman');
const head = document.getElementById('head');
const armLeft = document.getElementById('arm-left');
const armRight = document.getElementById('arm-right');
const legLeft = document.getElementById('leg-left');
const legRight = document.getElementById('leg-right');

let currentX = window.innerWidth / 2;
let currentY = window.innerHeight / 2;
let targetX = currentX;
let targetY = currentY;
let velocity = { x: 0, y: 0 };
let isChasing = false;
let animationFrame = 0;
let facingRight = true;
let lastFootTime = 0;
const footInterval = 0.14; // seconds between steps when sprinting

const sprintSpeed = 480;
const wanderSpeed = 140;
const margin = 30;
const legSwingAngle = 35;
const animSpeed = 0.22;

function update(timeMs) {
  const dt = (timeMs - (update.lastTime || timeMs)) / 1000;
  update.lastTime = timeMs;

  const dx = targetX - currentX;
  const dy = targetY - currentY;
  const dist = Math.hypot(dx, dy);
  const speed = isChasing ? sprintSpeed : wanderSpeed;

  if (dist > 8) {
    velocity.x = (dx / dist) * speed;
    velocity.y = (dy / dist) * speed;
  } else {
    if (isChasing) {
      isChasing = false;
      playWhoosh(); // PANIC ESCAPE SOUND
      const angle = Math.random() * Math.PI * 2;
      const escapeDist = 400 + Math.random() * 700;
      targetX = currentX + Math.cos(angle) * escapeDist;
      targetY = currentY + Math.sin(angle) * escapeDist;
    } else {
      targetX += (Math.random() - 0.5) * 220;
      targetY += (Math.random() - 0.5) * 160;
    }
    targetX = Math.max(margin, Math.min(window.innerWidth - margin - 60, targetX));
    targetY = Math.max(margin, Math.min(window.innerHeight - margin - 100, targetY));
  }

  currentX += velocity.x * dt;
  currentY += velocity.y * dt;

  currentX = Math.max(margin, Math.min(window.innerWidth - margin - 60, currentX));
  currentY = Math.max(margin, Math.min(window.innerHeight - margin - 100, currentY));

  container.style.left = `${currentX}px`;
  container.style.top = `${currentY}px`;

  facingRight = velocity.x >= 0;
  svg.style.transform = facingRight ? 'scaleX(1)' : 'scaleX(-1)';

  animationFrame += animSpeed * (speed / wanderSpeed);
  const swing = Math.sin(animationFrame) * legSwingAngle;

  legLeft.setAttribute('x2', 30 - swing * (facingRight ? 1 : -1));
  legLeft.setAttribute('y2', 90 + Math.abs(swing) / 2.5);
  legRight.setAttribute('x2', 30 + swing * (facingRight ? 1 : -1));
  legRight.setAttribute('y2', 90 - Math.abs(swing) / 2.5);

  armLeft.setAttribute('x2', 30 - swing * 1.3 * (facingRight ? 1 : -1));
  armLeft.setAttribute('y2', 45 + swing / 1.8);
  armRight.setAttribute('x2', 30 + swing * 1.3 * (facingRight ? 1 : -1));
  armRight.setAttribute('y2', 45 - swing / 1.8);

  head.setAttribute('cy', 20 + Math.sin(animationFrame * 1.8) * 2.5);

  // Procedural footsteps â€“ only when moving fast
  const velMag = Math.hypot(velocity.x, velocity.y);
  if (velMag > 80 && timeMs - lastFootTime > footInterval * 1000) {
    createFootstep();
    // Offset second foot slightly
    setTimeout(createFootstep, 60 + Math.random() * 40);
    lastFootTime = timeMs;
  }

  requestAnimationFrame(update);
}

// Click â†’ CHARGE
document.addEventListener('click', e => {
  if (!audioCtx) return;
  if (audioCtx.state === 'suspended') audioCtx.resume(); // Wake on first interaction
  targetX = e.clientX - 30;
  targetY = e.clientY - 50;
  isChasing = true;
  createFootstep(); // immediate step on click
});

// Touch too
document.addEventListener('touchstart', e => {
  if (e.touches.length === 1) {
    e.preventDefault();
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    targetX = e.touches[0].clientX - 30;
    targetY = e.touches[0].clientY - 50;
    isChasing = true;
    createFootstep();
  }
}, { passive: false });

// Resize clamp
window.addEventListener('resize', () => {
  currentX = Math.min(currentX, window.innerWidth - 90);
  currentY = Math.min(currentY, window.innerHeight - 130);
  targetX = Math.min(targetX, window.innerWidth - 90);
  targetY = Math.min(targetY, window.innerHeight - 130);
});

// Launch the eternal panic
container.style.left = `${currentX}px`;
container.style.top = `${currentY}px`;
requestAnimationFrame(update);
</script>
</body>
</html>